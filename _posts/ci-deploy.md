---
title: ä½¿ç”¨CIè‡ªåŠ¨éƒ¨ç½²åšå®¢
date: 2018-10-15 17:40:19
tags:
---

ç»è¿‡äº†~~å‰å‡ å¤©~~ä¸€å¤©çš„æŠ˜è…¾ï¼Œæˆ‘çš„åšå®¢ç»ˆäºèƒ½å¤Ÿä½¿ç”¨CIè‡ªåŠ¨éƒ¨ç½²äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦å†™Markdownæ–‡ä»¶å¹¶pushåˆ°Githubä¸Šç‰¹å®šçš„repoç„¶åå°±å¯ä»¥éƒ¨ç½²ä¸Šäº†ğŸ˜€

<!-- more -->

## Why CI ï¼Ÿ

æœ€å¼€å§‹çš„åšå®¢æ˜¯åœ¨ä½¿ç”¨WSLä¸­çš„NodeJSæ­å»ºçš„ï¼Œä¹‹åé‡è£…äº†ç³»ç»Ÿå«Œéº»çƒ¦ï¼Œä¸æƒ³å†è£…é‚£ä¸€å¨ä¸œè¥¿ï¼Œæ‰€ä»¥å†™åšå®¢çš„äº‹æƒ…å°± ~~ç†æ‰€åº”å½“åœ°~~ ä¸€ç›´è¢«æç½®äº†ã€‚ä»å“ªä¹‹åï¼Œå°±æœ‰ä¸ªæƒ³æ³•ï¼šè¦æ˜¯åªå†™Markdownå‰©ä¸‹çš„éƒ½èƒ½å¤Ÿè‡ªåŠ¨åŒ–å°±å¥½äº†ã€‚å®ä¹ ä¹‹åæ¥è§¦åˆ°äº†CIï¼Œå°±åˆæœ‰äº†ä¸ªæƒ³æ³•ï¼Œäºæ˜¯å°±æœ‰äº†å¯ä»¥è‡ªåŠ¨åŒ–éƒ¨ç½²çš„åšå®¢å’Œæ°´çš„è¿™ç¯‡åšå®¢ã€‚

æ„Ÿè§‰ç›®å‰è¿™ç§å®è·µçš„æœ€å¤§çš„å¥½å¤„å°±æ˜¯ä¸å—é‚£äº›å®‰è£…ç¯å¢ƒçš„ç‹—é€¼äº‹æƒ…çš„å½±å“ï¼Œåªæ˜¯ä¸“æ³¨åœ¨å†…å®¹ç¼–å†™æœ¬èº«ã€‚å³ä½¿æ¢äº†ä¸€å°æ–°çš„ç”µè„‘ï¼Œä¹Ÿåªéœ€è¦ä¸€ä¸ªGitã€‚

## What is CI?

> æŒç»­é›†æˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œå³å›¢é˜Ÿå¼€å‘æˆå‘˜ç»å¸¸é›†æˆä»–ä»¬çš„å·¥ä½œï¼Œé€šè¿‡æ¯ä¸ªæˆå‘˜æ¯å¤©è‡³å°‘é›†æˆä¸€æ¬¡ï¼Œä¹Ÿå°±æ„å‘³ç€æ¯å¤©å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡é›†æˆã€‚æ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºï¼ˆåŒ…æ‹¬ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰æ¥éªŒè¯ï¼Œä»è€Œå°½æ—©åœ°å‘ç°é›†æˆé”™è¯¯ã€‚
> 
> â€”â€”ç™¾åº¦ç™¾ç§‘

ç®€å•çš„æ¥è¯´å°±æ˜¯åœ¨äº‹å…ˆé…ç½®å¥½çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚pushåˆ°ä¸€ä¸ªä»“åº“ï¼‰ï¼Œè‡ªåŠ¨è§¦å‘å¹¶æ‰§è¡Œé¢„è®¾çš„ä¸€è¿ä¸²æ“ä½œï¼ˆegï¼šç¼–è¯‘ï¼Œå•å…ƒæµ‹è¯•ï¼‰

ç»è¿‡å®è·µï¼Œå‘ç°ä½¿ç”¨è¿‡çš„Gitlab-CIå’ŒTravis-CIéƒ½æ˜¯åœ¨æ‰§è¡ŒCIçš„æ—¶å€™å¯åŠ¨ä¸€ä¸ªdockerå®¹å™¨ã€‚ç„¶ååœ¨å®¹å™¨å†…å®Œæˆå¯¹åº”çš„æ“ä½œï¼ŒCIè„šæœ¬æ‰€ä½¿ç”¨çš„æ­£æ˜¯shellå‘½ä»¤ï¼

## How to CIï¼Ÿ

ä¹‹å‰å®ä¹ çš„æ—¶å€™å…¬å¸çš„ä»£ç æ˜¯æ‰˜ç®¡åœ¨å†…ç½‘è‡ªå·±æ­å»ºçš„Gitlabä¸Šçš„ï¼Œä¸å¾—ä¸è¯´Gitlabè‡ªå¸¦çš„CI/CDè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚è°ƒç ”äº†ä¸€åœˆå‘ç°Githubä¸Šç”¨çš„æ¯”è¾ƒå¤šåˆ°æ˜¯Travis-CIï¼Œä¸è¿‡ç†Ÿæ‚‰ä¹‹åå‘ç°CIå¥½åƒéƒ½æ˜¯ä¸€ä¸ªå¥—è·¯ğŸ˜‚ã€‚

ç›®å‰çš„åšæ³•æ˜¯å°†Hexoåšå®¢ä¸­ç”¨æ¥å­˜æ”¾åšæ–‡çš„_postsæ–‡ä»¶å¤¹å•ç‹¬ç‹¬ç«‹å‡ºæ¥å’Œ`.travis.yml`ä¸€èµ·ï¼Œä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ä»“åº“(Blog-Content)ã€‚è€Œå‰©ä¸‹çš„ä½œä¸ºå¦å¤–ä¸€ä¸ªä»“åº“(Blog-Hexo)ã€‚

ç»è¿‡å¤šæ¬¡çš„ç„å­¦ç¿»è½¦ï¼Œé…ç½®æ–‡ä»¶æœ€ç»ˆå®Œæˆçš„æ“ä½œå¦‚ä¸‹ï¼š
* å°†ä¸¤ä¸ªä»“åº“çš„å†…å®¹åˆå¹¶
* ä½¿ç”¨`sed`å°†Hexoçš„_config.ymlä¸­access_tokenæ›¿æ¢ä¸ºçœŸæ­£çš„Access Token
  ```yml
  # exmaple
  deploy:
    type: git
    repo: https://access_token@github.com/0x4f5da2/0x4f5da2.github.io.git
    branch: master
  ```
* è¿è¡ŒHexoç›¸å…³å‘½ä»¤å¹¶éƒ¨ç½²

æœ€åçš„`.travis.yml`å¦‚ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯éƒ¨åˆ†æ•æ„Ÿä¿¡æ¯éœ€è¦æ”¾ç½®åœ¨ç¯å¢ƒå˜é‡é‡Œé¢é¿å…æ˜¾å¼åœ°ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨çš„æ—¶å€™ç”¨`${...}`å¼•å…¥ã€‚

```yml
language: node_js
node_js: stable
sudo: required
branches:
  only:
  - master
before_install:
- git clone https://${ACCESS_TOKEN}@github.com/0x4f5da2/Blog-Hexo.git
- mkdir Blog-Hexo/source
- cp -r _posts Blog-Hexo/source
- npm install -g hexo-cli
install:
- cd Blog-Hexo
- npm install
- npm install hexo-deployer-git --save
script:
- hexo clean
- hexo generate
after_script:
- git config --global user.name "${GIT_NAME}"
- git config --global user.email "${GIT_EMAIL}"
- sed -i "s/access_token/${ACCESS_TOKEN}/g" ./_config.yml
- hexo deploy
```

ç„¶åï¼Œæ¯æ¬¡åœ¨å‘Blog-Contentä»“åº“pushçš„æ—¶å€™ï¼Œå°±èƒ½å¤Ÿè‡ªåŠ¨åœ°éƒ¨ç½²äº†

--- 

## æ›´æ–°

ä¹‹ååˆåŠ ä¸Šäº†coding.netçš„CIéƒ¨ç½²ï¼Œå…·ä½“çš„ä¿¡æ¯å¯ä»¥çœ‹Githubä¸Šå¯¹åº”ä»“åº“çš„`.travis-ci.yml`